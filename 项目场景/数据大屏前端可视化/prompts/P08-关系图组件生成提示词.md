# P08-关系图组件生成提示词（通用版）

> **📌 用途**: 生成ECharts关系图（Graph）组件，用于展示系统拓扑、网络结构、依赖关系等。

---

## 🎭 R - 角色定义

你是一位资深数据可视化工程师，拥有8年ECharts/D3.js开发经验，擅长：

- ECharts关系图表开发
- 网络拓扑可视化
- 力导向布局算法
- 图交互设计

---

## 📋 T - 任务描述

基于以下需求，生成关系图（Graph）组件。

### 输入材料

#### 材料1：组件需求

```
【组件名称】{填写组件名称，如"系统关联拓扑图"}

【布局类型】
- 布局算法：{力导向/环形/树形/固定位置}
- 力导向参数：斥力{斥力值}，引力{引力值}

【节点样式】
- 节点形状：{圆形/矩形/图标}
- 节点大小：{固定大小/按权重缩放}px
- 节点颜色：{按分类着色/按状态着色}
- 节点标签：{显示/隐藏}，位置{内部/外部}

【连线样式】
- 线条类型：{直线/曲线}
- 线条宽度：{固定/按权重}px
- 箭头：{显示/隐藏}
- 标签：{显示关系名称/隐藏}

【交互效果】
- 拖拽：{支持节点拖拽/不支持}
- Hover：{高亮关联节点/显示Tooltip}
- 点击：{展开子节点/触发事件}
- 缩放：{支持/不支持}

【数据结构】
{
  nodes: {
    id: string,           // 节点唯一标识
    name: string,         // 节点名称
    category?: string,    // 分类（用于着色）
    value?: number,       // 权重（用于大小）
    x?: number,           // 固定X坐标（可选）
    y?: number            // 固定Y坐标（可选）
  }[],
  links: {
    source: string,       // 源节点ID
    target: string,       // 目标节点ID
    value?: number,       // 关系权重
    label?: string        // 关系名称
  }[]
}
```

#### 材料2：技术要求

```
- 框架：{Vue 3/React 18}
- 图表库：{ECharts 5/其他}
- 样式：使用设计系统CSS变量
```

### 任务上下文

{描述组件的使用场景，如"用于展示系统间的调用关系，支持拖拽调整布局"}

---

## 🎯 G - 目标与意图

### 核心目标

生成一个**结构清晰、布局美观、交互灵活**的关系图组件，展示节点间的关联关系。

### 具体目标

1. **结构清晰**: 节点层次分明，关系线条不交叉
2. **布局美观**: 力导向自动排列，支持手动调整
3. **交互灵活**: 拖拽、缩放、高亮、下钻
4. **可扩展**: 支持动态添加/删除节点

### 业务价值

- **为运维人员**: 直观了解系统依赖，快速定位问题
- **为架构师**: 系统全景视图，辅助架构决策
- **为开发团队**: 可复用组件，统一拓扑展示

### 成功标准

- ✅ 力导向布局稳定收敛，不持续抖动
- ✅ 节点拖拽后位置保持
- ✅ 支持高亮显示关联路径
- ✅ 代码包含完整TypeScript类型定义

---

## 📤 O - 输出要求

### 1. 输出结构

```
src/components/charts/
├── GraphChart.vue         # 关系图组件
├── GraphChart.types.ts    # 类型定义
└── useGraphChart.ts       # 组合式函数（图表逻辑）
```

### 2. 质量要求

#### 代码规范
- Props使用 `defineProps<T>()` 泛型定义
- 支持v-model绑定选中节点
- 节点位置变化后emit更新事件

#### 性能规范
- 大量节点（>100）时优化力导向计算
- 使用 `ResizeObserver` 监听容器变化
- 支持渐进式布局收敛

### 3. 格式规范

- ECharts配置项分离到单独函数
- 颜色使用设计系统定义

### 4. 特别说明

#### 力导向参数配置

```typescript
const getForceLayout = (nodeCount: number) => ({
  force: {
    repulsion: Math.max(500, nodeCount * 10),  // 斥力随节点数调整
    gravity: 0.1,
    edgeLength: [50, 200],
    layoutAnimation: true
  }
})
```

#### 关联高亮实现

```typescript
const highlightRelated = (nodeId: string) => {
  const relatedNodes = new Set<string>([nodeId])
  const relatedLinks = new Set<number>()
  
  links.forEach((link, index) => {
    if (link.source === nodeId || link.target === nodeId) {
      relatedNodes.add(link.source)
      relatedNodes.add(link.target)
      relatedLinks.add(index)
    }
  })
  
  chartInstance.value?.setOption({
    series: [{
      data: nodes.map(node => ({
        ...node,
        itemStyle: {
          opacity: relatedNodes.has(node.id) ? 1 : 0.2
        }
      })),
      links: links.map((link, index) => ({
        ...link,
        lineStyle: {
          opacity: relatedLinks.has(index) ? 1 : 0.1
        }
      }))
    }]
  })
}
```

#### 节点拖拽固定

```typescript
chartInstance.value?.on('mouseup', (params) => {
  if (params.componentType === 'series' && params.seriesType === 'graph') {
    const nodeData = params.data
    // 固定节点位置
    emit('node-moved', {
      id: nodeData.id,
      x: params.event.offsetX,
      y: params.event.offsetY
    })
  }
})
```

---

## ✨ 输出格式

直接输出完整的Vue组件代码，包含类型定义和组合式函数。
