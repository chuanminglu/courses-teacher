# CI持续集成最佳实践指南 - 电子书生成指南

## 📚 电子书生成方案

### 方案1：使用Gitiles + Pandoc (推荐)

#### 安装工具
```bash
# 1. 安装Pandoc
# Windows: 下载安装包
# https://github.com/jgm/pandoc/releases

# 2. 安装LaTeX (用于PDF生成)
# 安装MiKTeX或TeX Live
```

#### 生成命令
```bash
# 生成PDF电子书
pandoc "CI持续集成最佳实践指南-Step-by-Step.md" \
    -o "CI持续集成最佳实践指南.pdf" \
    --toc \
    --toc-depth=3 \
    --number-sections \
    --pdf-engine=xelatex \
    -V mainfont="Microsoft YaHei" \
    -V geometry:margin=2cm

# 生成EPUB电子书
pandoc "CI持续集成最佳实践指南-Step-by-Step.md" \
    -o "CI持续集成最佳实践指南.epub" \
    --toc \
    --toc-depth=3 \
    --epub-cover-image=cover.jpg

# 生成HTML单页面
pandoc "CI持续集成最佳实践指南-Step-by-Step.md" \
    -o "CI持续集成最佳实践指南.html" \
    --toc \
    --toc-depth=3 \
    --number-sections \
    --css=style.css \
    --standalone
```

### 方案2：使用mdBook

#### 安装和配置
```bash
# 1. 安装mdBook
cargo install mdbook

# 2. 创建电子书项目
mdbook init ci-best-practices-book
cd ci-best-practices-book
```

#### 目录结构重组
```
ci-best-practices-book/
├── book.toml           # 配置文件
├── src/
│   ├── SUMMARY.md      # 目录结构
│   ├── introduction.md
│   ├── chapter1/
│   │   ├── README.md
│   │   ├── section1.md
│   │   └── section2.md
│   ├── chapter2/
│   └── ...
```

### 方案3：使用GitBook

#### 在线平台方案
1. 访问 https://www.gitbook.com/
2. 导入Markdown文件
3. 自动生成在线电子书
4. 支持PDF导出

### 方案4：使用Typora (最简单)

#### 操作步骤
1. 用Typora打开Markdown文件
2. 文件 → 导出 → PDF/HTML/Word
3. 选择样式和格式
4. 一键生成电子书

## 🛠️ 实用脚本

### PowerShell自动化脚本
```powershell
# generate-ebook.ps1
param(
    [string]$InputFile = "CI持续集成最佳实践指南-Step-by-Step.md",
    [string]$OutputDir = "output",
    [switch]$GenerateAll
)

# 创建输出目录
if (-not (Test-Path $OutputDir)) {
    New-Item -ItemType Directory -Path $OutputDir
}

$BaseFileName = "CI持续集成最佳实践指南"

Write-Host "🚀 开始生成电子书..." -ForegroundColor Green

if ($GenerateAll -or (Read-Host "生成PDF? (y/n)") -eq "y") {
    Write-Host "📄 生成PDF..." -ForegroundColor Yellow
    & pandoc $InputFile `
        -o "$OutputDir\$BaseFileName.pdf" `
        --toc --toc-depth=3 --number-sections `
        --pdf-engine=xelatex `
        -V mainfont="Microsoft YaHei" `
        -V geometry:margin=2cm `
        -V documentclass=book `
        -V papersize=a4
}

if ($GenerateAll -or (Read-Host "生成EPUB? (y/n)") -eq "y") {
    Write-Host "📱 生成EPUB..." -ForegroundColor Yellow
    & pandoc $InputFile `
        -o "$OutputDir\$BaseFileName.epub" `
        --toc --toc-depth=3 `
        --epub-metadata=metadata.xml
}

if ($GenerateAll -or (Read-Host "生成HTML? (y/n)") -eq "y") {
    Write-Host "🌐 生成HTML..." -ForegroundColor Yellow
    & pandoc $InputFile `
        -o "$OutputDir\$BaseFileName.html" `
        --toc --toc-depth=3 --number-sections `
        --css=github.css --standalone `
        --highlight-style=github
}

if ($GenerateAll -or (Read-Host "生成Word? (y/n)") -eq "y") {
    Write-Host "📝 生成Word..." -ForegroundColor Yellow
    & pandoc $InputFile `
        -o "$OutputDir\$BaseFileName.docx" `
        --toc --toc-depth=3 --number-sections `
        --reference-doc=template.docx
}

Write-Host "✅ 电子书生成完成！输出目录: $OutputDir" -ForegroundColor Green
```

### 文档分割脚本
```powershell
# split-chapters.ps1 - 将大文档分割为章节
param([string]$InputFile = "CI持续集成最佳实践指南-Step-by-Step.md")

$content = Get-Content $InputFile -Encoding UTF8
$chapters = @{}
$currentChapter = ""
$currentContent = @()

foreach ($line in $content) {
    if ($line -match "^## .* 第(\d+)章") {
        # 保存前一章
        if ($currentChapter -ne "") {
            $chapters[$currentChapter] = $currentContent
        }
        
        # 开始新章
        $currentChapter = $matches[1]
        $currentContent = @($line)
    } else {
        $currentContent += $line
    }
}

# 保存最后一章
if ($currentChapter -ne "") {
    $chapters[$currentChapter] = $currentContent
}

# 输出章节文件
New-Item -ItemType Directory -Path "chapters" -Force
foreach ($chapter in $chapters.Keys) {
    $fileName = "chapters\第${chapter}章.md"
    $chapters[$chapter] | Out-File $fileName -Encoding UTF8
    Write-Host "生成: $fileName" -ForegroundColor Green
}
```

## 📋 推荐配置文件

### Pandoc样式配置 (style.css)
```css
/* github.css - GitHub风格样式 */
body {
    font-family: "Microsoft YaHei", "Helvetica Neue", Helvetica, Arial, sans-serif;
    font-size: 14px;
    line-height: 1.6;
    color: #333;
    max-width: 1000px;
    margin: 0 auto;
    padding: 20px;
}

h1, h2, h3, h4, h5, h6 {
    margin-top: 30px;
    margin-bottom: 16px;
    font-weight: 600;
    line-height: 1.25;
}

h1 { font-size: 2em; border-bottom: 2px solid #eaecef; padding-bottom: 10px; }
h2 { font-size: 1.5em; border-bottom: 1px solid #eaecef; padding-bottom: 8px; }
h3 { font-size: 1.25em; }

pre, code {
    font-family: "Consolas", "Liberation Mono", Menlo, Courier, monospace;
    background-color: #f6f8fa;
}

pre {
    padding: 16px;
    overflow: auto;
    border-radius: 6px;
    border: 1px solid #e1e4e8;
}

table {
    border-collapse: collapse;
    margin: 20px 0;
    width: 100%;
}

th, td {
    border: 1px solid #dfe2e5;
    padding: 8px 12px;
    text-align: left;
}

th {
    background-color: #f6f8fa;
    font-weight: 600;
}

blockquote {
    margin: 0;
    padding: 0 16px;
    color: #6a737d;
    border-left: 4px solid #dfe2e5;
}

.toc ul {
    list-style-type: none;
    padding-left: 20px;
}

.toc a {
    text-decoration: none;
    color: #0366d6;
}

.toc a:hover {
    text-decoration: underline;
}
```

### mdBook配置 (book.toml)
```toml
[book]
authors = ["课程团队"]
title = "CI持续集成最佳实践指南"
description = "从零到一掌握企业级CI/CD最佳实践"
language = "zh-CN"

[build]
build-dir = "book"

[output.html]
theme = "theme"
default-theme = "light"
preferred-dark-theme = "navy"
curly-quotes = true
mathjax-support = true
copy-fonts = true
additional-css = ["theme/custom.css"]

[output.html.search]
enable = true
limit-results = 20
teaser-word-count = 30
use-boolean-and = true
boost-title = 2
boost-hierarchy = 1
boost-paragraph = 1
expand = true
heading-split-level = 2

[output.html.print]
enable = true
```

## 🚀 快速开始

### 最简单的方法
```bash
# 1. 确保安装了Pandoc
pandoc --version

# 2. 生成PDF (推荐)
pandoc "CI持续集成最佳实践指南-Step-by-Step.md" -o "CI最佳实践.pdf" --toc --pdf-engine=xelatex

# 3. 生成HTML
pandoc "CI持续集成最佳实践指南-Step-by-Step.md" -o "CI最佳实践.html" --toc --standalone
```

### 使用我提供的脚本
```powershell
# 运行自动化脚本
.\generate-ebook.ps1 -GenerateAll
```

## 📱 移动端优化

### 响应式CSS
```css
@media screen and (max-width: 768px) {
    body {
        padding: 10px;
        font-size: 16px;
    }
    
    pre {
        overflow-x: auto;
        white-space: pre-wrap;
    }
    
    table {
        font-size: 12px;
    }
}
```

## 🎯 推荐方案

**对于个人使用：** Typora导出或Pandoc命令行
**对于团队分享：** mdBook或GitBook在线版本  
**对于正式发布：** Pandoc + LaTeX生成专业PDF

选择适合您需求的方案，都能生成高质量的电子书！
