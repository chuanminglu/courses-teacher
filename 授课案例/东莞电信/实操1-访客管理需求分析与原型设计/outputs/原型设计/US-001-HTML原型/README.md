# US-001 访客预约申请 - HTML交互原型

## 📋 原型说明

本原型是基于**US-001"访客在线提交预约申请"**用户故事开发的中低保真交互原型，用于产品演示和用户体验测试。

### 原型特点

- ✅ **UI风格**：采用Ant Design设计规范
- ✅ **技术栈**：纯HTML + CSS + JavaScript（无需构建工具）
- ✅ **可运行性**：双击HTML文件即可在浏览器中运行
- ✅ **数据存储**：使用localStorage模拟后端数据存储
- ✅ **交互完整**：实现所有定义的表单验证、页面跳转和反馈机制

---

## 📂 文件结构

```
US-001-HTML原型/
├── P1-访客预约申请表单.html    （主表单页面）
├── P2-预约提交成功页.html      （提交成功页）
└── README.md                    （本文件）
```

**注意**：P3照片上传弹窗已整合到P1页面中（作为模态弹窗）

---

## 🚀 如何使用

### 方法1：直接打开

1. 双击 `P1-访客预约申请表单.html` 文件
2. 在浏览器中打开
3. 开始填写表单并测试

### 方法2：本地服务器（推荐）

如果遇到浏览器安全限制，建议使用本地服务器：

**使用Python（推荐）**:
```bash
# Python 3
python -m http.server 8000

# Python 2
python -m SimpleHTTPServer 8000
```

**使用Node.js**:
```bash
npx http-server -p 8000
```

然后访问：`http://localhost:8000/P1-访客预约申请表单.html`

---

## 🎯 功能清单

### P1: 访客预约申请表单

#### ✅ 页面元素（27个）

**头部区域（2个）**:
- H1: 页面标题"访客预约申请"
- H2: 填写说明

**个人信息区域（4个字段）**:
- F1: 访客姓名（2-20字符，中英文验证）
- F2: 手机号码（11位手机号验证）
- F3: 身份证号（18位身份证号验证）
- F4: 访客照片（JPG/PNG，≤5MB）

**来访信息区域（5个字段）**:
- F5: 来访目的（下拉选择）
- F6: 其他说明（F5选择"其他"时显示，≤200字符）
- F7: 访问日期（今天～今天+30天）
- F8: 访问时段（上午/下午单选）
- F9: 被访人（搜索下拉框）

**提交按钮（1个）**:
- BTN1: 提交预约

**提示消息（9个）**:
- M1: 照片上传成功
- M2-M7: 字段验证错误提示
- M8: 重复提交警告
- M9: 加载提示

#### ✅ 交互功能

**表单验证**:
- ✅ 实时字段验证（失去焦点时）
- ✅ 正则表达式验证（姓名、手机号、身份证号）
- ✅ 日期范围验证（今天～30天后）
- ✅ 必填字段验证
- ✅ 错误提示显示（红色边框+错误文本）

**照片上传**:
- ✅ 点击上传按钮弹出操作菜单（模拟P3）
- ✅ 选择"拍照"或"从相册选择"（实际调用文件选择器）
- ✅ 照片格式验证（JPG/PNG）
- ✅ 照片大小验证（≤5MB）
- ✅ 照片预览显示
- ✅ 删除照片功能

**被访人搜索**:
- ✅ 输入搜索关键词（防抖300ms）
- ✅ 实时过滤搜索结果（支持姓名、工号、部门）
- ✅ 搜索结果列表显示（最多10条）
- ✅ 选择员工后显示标签
- ✅ 清除选择功能
- ✅ 无搜索结果提示

**动态显示**:
- ✅ 来访目的选择"其他"时显示F6"其他说明"字段
- ✅ 选择非"其他"时隐藏F6字段

**提交流程**:
- ✅ 前端验证所有字段
- ✅ 验证失败显示错误提示
- ✅ 验证成功显示加载遮罩（2秒）
- ✅ 模拟API调用
- ✅ 生成预约单号（格式YY202511270001）
- ✅ 保存到localStorage
- ✅ 显示成功Toast（1秒）
- ✅ 自动跳转到P2成功页

**重复提交防护**:
- ✅ 检测当天是否已提交预约
- ✅ 显示警告条
- ✅ 禁用提交按钮

---

### P2: 预约提交成功页

#### ✅ 页面元素（8个）

**主内容区（6个）**:
- D1: 成功图标（绿色对勾，带缩放旋转动画）
- D2: 成功提示标题"预约提交成功！"
- D3: 预约单号标签
- D4: 预约单号（支持长按复制）
- D5: 状态说明"预约状态：待审批"
- D6: 后续指引文本

**交互按钮（2个）**:
- I1: 查看我的预约（跳转US-002，当前为alert模拟）
- I2: 返回首页（返回P1表单页）

#### ✅ 交互功能

**数据显示**:
- ✅ 从URL参数或localStorage读取预约信息
- ✅ 显示预约单号

**预约单号复制**:
- ✅ 长按预约单号（500ms）触发复制
- ✅ 复制成功显示Toast提示"已复制"
- ✅ 复制成功时预约单号缩放动画
- ✅ 支持PC端（鼠标长按）和移动端（触摸长按）

**页面跳转**:
- ✅ 点击"查看我的预约"跳转US-002（当前alert模拟）
- ✅ 点击"返回首页"返回P1表单页

**页面动画**:
- ✅ 页面加载淡入动画
- ✅ 成功图标缩放旋转动画

---

## 🧪 测试指南

### 测试场景1：正常提交流程

1. 打开P1页面
2. 填写所有必填字段：
   - 姓名：张三
   - 手机号：13800138000
   - 身份证号：440301199001011234
   - 照片：上传任意JPG/PNG图片
   - 来访目的：业务洽谈
   - 访问日期：选择明天
   - 访问时段：上午
   - 被访人：搜索并选择"张三"
3. 点击"提交预约"
4. 观察：
   - ✅ 显示加载遮罩"正在提交预约..."
   - ✅ 2秒后显示"提交成功"Toast
   - ✅ 1秒后跳转到P2成功页
5. 在P2页面观察：
   - ✅ 显示成功图标（带动画）
   - ✅ 显示预约单号
   - ✅ 显示状态"待审批"
6. 长按预约单号：
   - ✅ 显示"已复制"Toast
   - ✅ 预约单号缩放动画
7. 点击"返回首页"：
   - ✅ 返回P1表单页

---

### 测试场景2：表单验证

#### 测试姓名验证
- 输入空值 → 失去焦点 → 显示"请填写访客姓名"
- 输入"A" → 失去焦点 → 显示"姓名长度为2-20个字符"
- 输入"张三123" → 失去焦点 → 显示"姓名长度为2-20个字符，支持中英文"
- 输入"张三" → 失去焦点 → ✅ 验证通过

#### 测试手机号验证
- 输入"12345678901" → 失去焦点 → 显示"手机号格式不正确"
- 输入"1380013800" → 失去焦点 → 显示"手机号格式不正确"
- 输入"13800138000" → 失去焦点 → ✅ 验证通过

#### 测试身份证号验证
- 输入"123456789012345678" → 失去焦点 → 显示"身份证号格式不正确"
- 输入"440301199001011234" → 失去焦点 → ✅ 验证通过

#### 测试日期验证
- 选择昨天的日期 → 失去焦点 → 显示"访问日期不能早于今天"
- 选择31天后的日期 → 失去焦点 → 显示"访问日期不能超过30天后"
- 选择明天的日期 → 失去焦点 → ✅ 验证通过

---

### 测试场景3：照片上传

1. 点击"上传照片"按钮
2. 观察：
   - ✅ 弹出操作菜单（拍照/从相册选择/取消）
3. 点击"从相册选择"
4. 观察：
   - ✅ 打开文件选择器
5. 选择BMP格式图片
6. 观察：
   - ✅ 显示错误Toast"照片格式不支持，请上传JPG或PNG格式"
7. 选择大于5MB的JPG图片
8. 观察：
   - ✅ 显示错误Toast"照片大小不能超过5MB"
9. 选择小于5MB的JPG图片
10. 观察：
    - ✅ 显示照片预览（120px×160px）
    - ✅ 显示成功Toast"照片上传成功"
    - ✅ 右上角显示删除按钮
11. 点击删除按钮
12. 观察：
    - ✅ 照片预览消失
    - ✅ 恢复上传按钮

---

### 测试场景4：被访人搜索

1. 点击"被访人"输入框
2. 输入"张"
3. 观察（300ms防抖后）：
   - ✅ 显示搜索结果列表
   - ✅ 显示包含"张"的员工（张三）
4. 输入"E001"
5. 观察：
   - ✅ 显示工号E001的员工（张三）
6. 输入"技术部"
7. 观察：
   - ✅ 显示技术部的员工（张三、孙八）
8. 输入"不存在的员工"
9. 观察：
   - ✅ 显示"未找到匹配员工，请输入更多关键词"
10. 清空输入，输入"张三"
11. 点击搜索结果中的"张三"
12. 观察：
    - ✅ 搜索输入框隐藏
    - ✅ 显示已选择标签"张三（技术部）"
    - ✅ 搜索结果列表消失
13. 点击标签的删除按钮（✕）
14. 观察：
    - ✅ 标签消失
    - ✅ 搜索输入框恢复显示

---

### 测试场景5：动态字段显示

1. 来访目的选择"业务洽谈"
2. 观察：
   - ✅ F6"其他说明"字段隐藏
3. 来访目的选择"其他"
4. 观察：
   - ✅ F6"其他说明"字段显示
   - ✅ F6标记为必填（红色*）
5. 不填写F6，点击"提交预约"
6. 观察：
   - ✅ F6显示错误提示"请说明具体事由"
7. 填写F6，来访目的改选"参观考察"
8. 观察：
   - ✅ F6字段隐藏
   - ✅ F6内容被清空

---

### 测试场景6：重复提交防护

1. 完成一次正常提交流程
2. 返回P1表单页
3. 观察：
   - ✅ 页面顶部显示橙色警告条"您今天已提交过预约，同一天只能提交1次"
   - ✅ "提交预约"按钮禁用（灰色）
4. 点击警告条的关闭按钮
5. 观察：
   - ✅ 警告条消失（但按钮仍然禁用）

---

### 测试场景7：响应式布局

1. 缩小浏览器窗口到375px宽度（iPhone尺寸）
2. 观察：
   - ✅ 布局自动调整为单列
   - ✅ 表单字段宽度100%
   - ✅ 按钮宽度100%
   - ✅ 字体大小适配
   - ✅ 照片上传弹窗从底部滑入

---

## 📊 数据存储说明

### localStorage数据结构

**键：`appointments`** （预约记录数组）
```json
[
  {
    "visitorName": "张三",
    "visitorPhone": "13800138000",
    "visitorIdCard": "440301199001011234",
    "visitorPhoto": "data:image/jpeg;base64,...",
    "visitPurpose": "业务洽谈",
    "visitPurposeDesc": "",
    "visitDate": "2025-11-28",
    "visitTimeSlot": "上午",
    "visiteeId": "1",
    "visiteeName": "张三（技术部）",
    "appointmentNumber": "YY202511270001",
    "status": "待审批",
    "createTime": "2025-11-27T10:30:00.000Z"
  }
]
```

**键：`latestAppointment`** （最新的预约记录）
```json
{
  "visitorName": "张三",
  ...
  "appointmentNumber": "YY202511270001"
}
```

### 清除数据

打开浏览器控制台（F12），执行以下命令：
```javascript
localStorage.clear();
```

或者只清除预约数据：
```javascript
localStorage.removeItem('appointments');
localStorage.removeItem('latestAppointment');
```

---

## 🎨 UI设计规范

### 颜色规范（Ant Design）

- **主题色**：`#1890ff`（蓝色）
- **成功色**：`#52c41a`（绿色）
- **警告色**：`#faad14`（橙色）
- **错误色**：`#ff4d4f`（红色）
- **文本色**：`rgba(0, 0, 0, 0.85)`
- **次要文本**：`rgba(0, 0, 0, 0.65)`
- **边框色**：`#d9d9d9`

### 字体规范

- **字体家族**：`-apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif`
- **基础字号**：14px
- **标题字号**：18px（H1）、16px（H2）
- **行高**：1.5715

### 间距规范

- **容器内边距**：24px（PC）、16px（移动端）
- **表单字段间距**：24px
- **表单区域间距**：24px
- **按钮高度**：32px（普通）、40px（主要）

---

## 🔧 技术实现说明

### 表单验证

**实时验证**：
- 字段失去焦点时验证
- 输入时清除错误状态
- 防抖300ms（被访人搜索）

**验证规则**：
- 姓名：`/^[\u4e00-\u9fa5a-zA-Z·]{2,20}$/`
- 手机号：`/^1[3-9]\d{9}$/`
- 身份证号：`/^[1-9]\d{5}(18|19|20)\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])\d{3}[\dXx]$/`

### 照片上传

**文件验证**：
- 格式：`['image/jpeg', 'image/png']`
- 大小：`≤ 5MB (5 * 1024 * 1024 bytes)`

**存储方式**：
- 使用`FileReader.readAsDataURL()`转换为base64
- 存储到localStorage（实际应上传到服务器）

### 数据提交

**模拟API调用**：
```javascript
setTimeout(() => {
  // 2秒后返回成功
  const appointmentNumber = generateAppointmentNumber();
  // 保存到localStorage
  // 跳转到成功页
}, 2000);
```

**预约单号生成**：
```javascript
function generateAppointmentNumber() {
  const now = new Date();
  const year = now.getFullYear().toString().slice(-2);
  const month = String(now.getMonth() + 1).padStart(2, '0');
  const day = String(now.getDate()).padStart(2, '0');
  const seq = String(Math.floor(Math.random() * 10000)).padStart(4, '0');
  return `YY${year}${month}${day}${seq}`;
}
```

---

## 🐛 已知限制

### 功能限制

1. **照片上传**：使用文件选择器模拟，实际应调用微信JSSDK
2. **被访人搜索**：使用本地模拟数据，实际应调用后端API
3. **数据持久化**：使用localStorage，实际应调用后端API
4. **页面跳转**：US-002页面未实现，使用alert模拟

### 浏览器兼容性

- ✅ Chrome 90+
- ✅ Edge 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ❌ IE（不支持）

---

## 📞 问题反馈

如果在测试过程中发现问题，请记录以下信息：

1. **问题描述**：具体现象
2. **复现步骤**：如何触发问题
3. **浏览器信息**：浏览器名称和版本
4. **截图**：问题界面截图

---

## 📝 更新日志

### v1.0 (2025-11-27)

- ✅ P1访客预约申请表单页面
- ✅ P2预约提交成功页面
- ✅ 完整的表单验证逻辑
- ✅ 照片上传功能（文件选择器模拟）
- ✅ 被访人搜索功能（本地数据模拟）
- ✅ 重复提交防护
- ✅ 响应式布局
- ✅ Ant Design风格UI

---

## 📚 相关文档

- [US-001 用户故事](../../访客预约模块用户故事.md)
- [US-001 页面元素分析](../US-001-页面元素分析.md)
- [US-001 交互逻辑设计](../US-001-交互逻辑设计.md)

---

**📌 提示**：本原型为演示版本，实际开发时需要对接真实后端API和微信JSSDK。
