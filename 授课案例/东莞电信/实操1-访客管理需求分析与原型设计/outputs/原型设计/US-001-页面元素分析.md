# 访客在线提交预约申请 - 页面元素分析

## Story概述

- **Story ID**: US-001
- **Story名称**: 访客在线提交预约申请
- **用户角色**: 访客
- **核心功能**: 通过微信公众号在线提交来访预约申请

---

## 页面列表

| 页面编号 | 页面名称 | 页面类型 | 访问路径 | 说明 |
|---------|---------|---------|---------|------|
| P1 | 访客预约申请表单 | 主页面 | `/visitor/appointment/create` | 访客填写预约信息的主表单页 |
| P2 | 预约提交成功页 | 提示页 | 提交成功后自动跳转 | 显示预约单号和后续操作指引 |
| P3 | 照片上传预览弹窗 | 弹窗 | 点击"上传照片"触发 | 调用微信相册/拍照，预览照片 |

---

## 页面详细设计

### P1: 访客预约申请表单

**页面用途**: 访客填写个人信息、来访信息并提交预约申请

**页面布局**: 
- 顶部：页面标题和说明
- 主内容区：分为"个人信息"、"来访信息"两个表单区域
- 底部：提交按钮

---

#### 1. 页面头部（Header）

| 元素ID | 元素名称 | 元素类型 | 说明 |
|-------|---------|---------|------|
| H1 | 访客预约申请 | 页面标题 | 一级标题，字体18px，加粗 |
| H2 | 填写说明 | 文本说明 | "请如实填写以下信息，带*为必填项"，字体14px，灰色 |

---

#### 2. 主内容区（Main Content）

##### 2.1 个人信息区域

| 元素ID | 字段名称 | 字段类型 | 必填性 | 数据类型 | 验证规则 | 默认值 | 提示文本 |
|-------|---------|---------|--------|---------|---------|--------|----------|
| F1 | 访客姓名 | 文本框 | ✅必填 | 字符串 | 2-20个字符，支持中英文 | 无 | 请输入真实姓名 |
| F2 | 手机号码 | 文本框 | ✅必填 | 字符串 | `/^1[3-9]\d{9}$/` | 无 | 请输入11位手机号 |
| F3 | 身份证号 | 文本框 | ✅必填 | 字符串 | `/^[1-9]\d{5}(18|19|20)\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])\d{3}[\dXx]$/` | 无 | 请输入18位身份证号 |
| F4 | 访客照片 | 文件上传 | ✅必填 | 图片文件 | JPG/PNG格式，≤5MB | 无 | 点击上传本人近期照片 |

**照片上传组件详细设计**:

| 子元素ID | 元素名称 | 元素类型 | 说明 |
|---------|---------|---------|------|
| F4-BTN | 上传照片按钮 | 图标按钮 | 蓝色虚线边框，内含相机图标和"上传照片"文字 |
| F4-PREVIEW | 照片预览区 | 图片容器 | 上传成功后显示，120px×160px，右上角有删除按钮 |
| F4-TIP | 上传说明 | 提示文本 | "支持JPG/PNG格式，文件不超过5MB"，字体12px，灰色 |

---

##### 2.2 来访信息区域

| 元素ID | 字段名称 | 字段类型 | 必填性 | 数据类型 | 验证规则 | 默认值 | 提示文本 |
|-------|---------|---------|--------|---------|---------|--------|----------|
| F5 | 来访目的 | 下拉框 | ✅必填 | 枚举值 | 业务洽谈/参观考察/面试招聘/其他 | 无 | 请选择来访目的 |
| F6 | 其他说明 | 文本域 | 选填 | 字符串 | ≤200字符 | 无 | 若选择"其他"，请说明具体事由 |
| F7 | 访问日期 | 日期选择器 | ✅必填 | 日期 | 不早于当前日期，不超过30天 | 无 | 请选择来访日期 |
| F8 | 访问时段 | 单选框组 | ✅必填 | 枚举值 | 上午(8:00-12:00)/下午(13:00-18:00) | 无 | 请选择来访时段 |
| F9 | 被访人 | 搜索下拉框 | ✅必填 | 用户ID | 从员工列表中选择 | 无 | 请输入被访人姓名或工号 |

**被访人搜索组件详细设计**:

| 子元素ID | 元素名称 | 元素类型 | 说明 |
|---------|---------|---------|------|
| F9-INPUT | 搜索输入框 | 文本框 | 支持拼音首字母搜索，实时过滤 |
| F9-LIST | 搜索结果列表 | 下拉列表 | 显示员工姓名、部门、工号，最多显示10条 |
| F9-SELECTED | 已选择标签 | 标签组件 | 显示已选择的被访人信息，可点击删除 |

---

##### 2.3 表单提交按钮

| 元素ID | 按钮文本 | 按钮类型 | 点击行为 |
|-------|---------|---------|----------|
| BTN1 | 提交预约 | 主按钮 | 验证表单 → 调用提交API → 跳转P2成功页 |

**按钮样式**:
- 宽度：100%（占满容器）
- 高度：44px
- 颜色：主题蓝色（#1890ff）
- 圆角：4px
- 禁用状态：灰色，必填字段未填写时禁用

---

#### 3. 反馈提示区域

| 元素ID | 提示类型 | 触发条件 | 提示内容 | 显示位置 |
|-------|---------|---------|---------|----------|
| M1 | 成功提示 | 照片上传成功 | "照片上传成功" | 照片预览区上方，绿色Toast，2秒自动消失 |
| M2 | 错误提示-姓名 | 姓名为空或不符合规则 | "请填写访客姓名" 或 "姓名长度为2-20个字符" | 姓名输入框下方，红色文字 |
| M3 | 错误提示-手机 | 手机号格式错误 | "手机号格式不正确，请填写11位手机号" | 手机号输入框下方，红色文字 |
| M4 | 错误提示-身份证 | 身份证格式错误 | "身份证号格式不正确，请填写18位身份证号" | 身份证输入框下方，红色文字 |
| M5 | 错误提示-照片 | 照片格式或大小不符 | "照片格式不支持" 或 "照片大小不能超过5MB" | 照片上传区下方，红色文字 |
| M6 | 错误提示-日期 | 日期不在允许范围 | "访问日期不能早于今天" 或 "访问日期不能超过30天后" | 日期选择器下方，红色文字 |
| M7 | 错误提示-被访人 | 未选择被访人 | "请选择被访人" | 被访人搜索框下方，红色文字 |
| M8 | 错误提示-重复 | 当天已提交预约 | "您今天已提交过预约，同一天只能提交1次" | 页面顶部，橙色警告条，持续显示 |
| M9 | 加载提示 | 提交中 | "正在提交预约..." | 页面中央，Loading遮罩层 |

---

### P2: 预约提交成功页

**页面用途**: 告知访客预约提交成功，展示预约单号和后续操作指引

**页面布局**: 垂直居中布局，图标+文字+操作按钮

---

#### 1. 主内容区（Main Content）

| 元素ID | 元素名称 | 元素类型 | 数据来源 | 说明 |
|-------|---------|---------|---------|------|
| D1 | 成功图标 | 图标 | 静态资源 | 绿色对勾图标，尺寸80px×80px |
| D2 | 成功提示标题 | 文本 | 固定文本 | "预约提交成功！"，字体20px，加粗 |
| D3 | 预约单号标签 | 文本 | 固定文本 | "预约单号："，字体14px |
| D4 | 预约单号 | 文本 | API返回 | 格式YY202511270001，字体16px，加粗，支持长按复制 |
| D5 | 状态说明 | 文本 | 固定文本 | "预约状态：待审批"，字体14px，灰色 |
| D6 | 后续指引 | 文本段落 | 固定文本 | "被访人将收到审批通知，审批通过后您将收到电子通行码。请保持手机畅通。"，字体14px，灰色 |

---

#### 2. 交互元素

| 元素ID | 元素名称 | 元素类型 | 触发条件 | 交互效果 |
|-------|---------|---------|---------|----------|
| I1 | 查看我的预约 | 按钮 | 点击 | 跳转到US-002预约记录列表页 |
| I2 | 返回首页 | 链接 | 点击 | 跳转到微信公众号首页 |

**按钮样式**:
- I1: 主按钮，蓝色，宽度100%，高度44px
- I2: 文字链接，灰色，居中对齐

---

### P3: 照片上传预览弹窗

**页面用途**: 调用微信JSSDK，选择照片/拍照，预览上传结果

**页面布局**: 弹窗覆盖层，底部弹出操作菜单

---

#### 1. 操作菜单区域

| 元素ID | 元素名称 | 元素类型 | 触发条件 | 交互效果 |
|-------|---------|---------|---------|----------|
| I3 | 拍照 | 菜单项 | 点击 | 调用微信相机API，拍照后预览 |
| I4 | 从相册选择 | 菜单项 | 点击 | 调用微信相册API，选择照片后预览 |
| I5 | 取消 | 菜单项 | 点击 | 关闭弹窗 |

---

#### 2. 照片预览区域（选择照片后显示）

| 元素ID | 元素名称 | 元素类型 | 说明 |
|-------|---------|---------|------|
| D7 | 照片预览图 | 图片 | 显示选择的照片，可缩放 |
| BTN2 | 确认上传 | 按钮 | 点击后上传至服务器，显示上传进度 |
| BTN3 | 重新选择 | 按钮 | 点击后返回操作菜单 |

**上传进度显示**:

| 元素ID | 元素名称 | 元素类型 | 说明 |
|-------|---------|---------|------|
| D8 | 上传进度条 | 进度条 | 0-100%，显示上传百分比 |
| D9 | 上传提示 | 文本 | "正在上传...X%"，上传完成后显示"上传成功" |

---

## 元素设计规范

### 输入验证规则

- **访客姓名验证**: `/^[\u4e00-\u9fa5a-zA-Z·]{2,20}$/` （中英文及中间点，2-20字符）
- **手机号验证**: `/^1[3-9]\d{9}$/` （1开头，第二位3-9，共11位）
- **身份证号验证**: `/^[1-9]\d{5}(18|19|20)\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])\d{3}[\dXx]$/`
- **照片格式验证**: `['image/jpeg', 'image/png']`
- **照片大小验证**: `≤ 5MB (5 * 1024 * 1024 bytes)`
- **访问日期验证**: `今天 ≤ 选择日期 ≤ 今天+30天`
- **其他说明验证**: `≤ 200字符`

### 错误提示文案规范

| 场景 | 提示文案 |
|------|---------|
| 姓名为空 | 请填写访客姓名 |
| 姓名格式错误 | 姓名长度为2-20个字符，支持中英文 |
| 手机号为空 | 请填写手机号码 |
| 手机号格式错误 | 手机号格式不正确，请填写11位手机号 |
| 身份证号为空 | 请填写身份证号 |
| 身份证号格式错误 | 身份证号格式不正确，请填写18位身份证号 |
| 照片未上传 | 请上传本人近期照片 |
| 照片格式不支持 | 照片格式不支持，请上传JPG或PNG格式 |
| 照片过大 | 照片大小不能超过5MB |
| 来访目的未选择 | 请选择来访目的 |
| 访问日期未选择 | 请选择访问日期 |
| 访问日期过早 | 访问日期不能早于今天 |
| 访问日期过晚 | 访问日期不能超过30天后 |
| 访问时段未选择 | 请选择访问时段 |
| 被访人未选择 | 请选择被访人 |
| 当天重复提交 | 您今天已提交过预约，同一天只能提交1次 |
| 网络错误 | 网络请求失败，请检查网络后重试 |
| 服务器错误 | 服务器繁忙，请稍后再试 |

### 响应式设计考虑

- **移动端（微信公众号H5）**: 
  - 主要适配：375px（iPhone）、414px（iPhone Plus）
  - 最小宽度：320px
  - 布局方式：单列垂直布局
  - 字体大小：最小12px，标题18px，正文14px
  - 按钮高度：44px（符合iOS人机界面指南）
  - 表单间距：上下16px，左右12px

### 可访问性要求

- **表单标签**: 所有表单字段必须有`<label for="field-id">`，点击标签聚焦输入框
- **图片描述**: 照片上传按钮`alt="上传访客照片"`，成功图标`alt="提交成功"`
- **颜色对比度**: 文字与背景对比度≥4.5:1（WCAG 2.1 AA级别）
- **错误提示**: 使用`aria-invalid="true"`和`aria-describedby`关联错误提示
- **加载状态**: 提交按钮禁用时显示`aria-busy="true"`和Loading图标

### 性能要求

- **照片上传**: 
  - 压缩策略：宽度>1080px时压缩至1080px，质量80%
  - 上传超时：15秒
  - 重试机制：失败后自动重试2次
  - 上传时长：P95 ≤ 3秒
- **页面加载**: 首屏加载时间 ≤ 2秒
- **表单验证**: 实时验证，防抖300ms

---

## 附录：元素ID命名规范

- **页面**: P1, P2, P3...
- **头部元素**: H1, H2, H3...
- **表单字段**: F1, F2, F3...
- **按钮**: BTN1, BTN2, BTN3...
- **数据展示**: D1, D2, D3...
- **交互元素**: I1, I2, I3...
- **提示消息**: M1, M2, M3...
- **底部元素**: FT1, FT2, FT3...
