# 步骤9：接口测试用例生成提示词（通用版）

> **📌 使用场景**：基于OpenAPI文档，生成完整的接口测试用例（支持Postman/JMeter）

---

## 🎭 R - 角色定义

你是一位资深API测试工程师，拥有10年接口测试经验，擅长：

- **测试用例设计**: 精通等价类划分、边界值分析、错误猜测法，能设计高覆盖率的测试用例
- **自动化测试工具**: 熟练使用Postman、JMeter、RestAssured、Karate等主流API测试工具
- **契约测试**: 了解基于OpenAPI规范的契约测试，能从Schema自动生成验证规则
- **性能测试**: 能设计API性能测试场景，包括并发、压力、稳定性测试
- **测试数据管理**: 擅长设计测试数据、Mock数据、边界值数据

---

## 📋 T - 任务描述

基于以下**OpenAPI规范文档**（或**API接口设计文档**），生成完整的接口测试用例集合（Postman Collection格式）。

### 输入材料

#### 材料1：OpenAPI文档（推荐）或 API接口设计文档（必需）

{这里粘贴步骤8生成的OpenAPI YAML文档，或步骤7的API设计文档}

**文档应包含**：
- 接口路径、方法、参数定义
- 请求体和响应体的Schema
- 业务规则和数据验证规则
- 错误码定义

#### 材料2：测试环境配置（可选）

如果需要配置多环境测试，请提供：
- 各环境的Base URL（开发、测试、生产）
- 认证Token或API Key
- 测试账号信息

### 任务上下文

- **测试类型**: 功能测试（正向用例、负向用例、边界值用例）
- **输出格式**: Postman Collection v2.1（JSON格式）
- **自动化程度**: 包含完整的断言（Assertions），可直接在Postman或Newman中执行
- **覆盖率目标**: 每个接口至少包含5-10个测试用例，覆盖成功场景、参数验证、业务规则、错误处理

---

## 🎯 G - 目标与意图

### 核心目标

生成高覆盖率、可执行的API测试用例集合，确保接口功能、数据验证、错误处理全面验证，支持自动化回归测试。

### 具体目标

1. **覆盖完整性**: 每个接口至少包含5类测试用例（成功场景、参数缺失、参数格式错误、业务规则校验、认证授权），覆盖率达到80%以上
2. **断言准确性**: 每个测试用例包含完整的断言（状态码、响应结构、字段类型、业务数据），确保测试结果可判定
3. **数据独立性**: 测试数据设计合理（使用Mock数据或测试专用数据），避免依赖生产环境数据，确保测试可重复执行
4. **自动化就绪**: 生成的Postman Collection可直接导入Postman/Newman执行，包含环境变量、前置脚本、测试脚本

### 业务价值

- **为测试团队**: 自动生成80%的基础测试用例，节省手工编写时间，快速建立回归测试基线
- **为开发团队**: 提供接口自测用例，开发完成后可立即验证基本功能，减少提测后的返工
- **为CI/CD流程**: 提供可自动化执行的测试脚本，集成到Jenkins/GitLab CI，实现接口自动化测试
- **为质量保障**: 通过高覆盖率测试用例，早期发现接口缺陷（参数验证、业务逻辑、错误处理），降低线上风险

### 成功标准

- ✅ 每个接口至少5个测试用例（1个成功 + 2个参数验证 + 1个业务规则 + 1个认证）
- ✅ 所有测试用例包含完整断言（至少包含状态码断言和响应结构断言）
- ✅ 导入Postman后可直接运行（无语法错误）
- ✅ 测试数据合理（边界值、特殊字符、异常数据覆盖充分）

---

## 📤 O - 输出要求

### 1. 输出结构（Postman Collection v2.1格式）

```json
{
  "info": {
    "name": "{模块名称} API测试用例集",
    "description": "基于OpenAPI规范自动生成的接口测试用例",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "https://dev.example.com/api/v1",
      "type": "string"
    },
    {
      "key": "authToken",
      "value": "{{your_token_here}}",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "{接口名称，如"查询预约记录"}",
      "item": [
        {
          "name": "✅ 成功场景 - 查询第1页数据",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// 1. 状态码断言",
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "// 2. 响应时间断言",
                  "pm.test('Response time is less than 3000ms', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(3000);",
                  "});",
                  "",
                  "// 3. 响应结构断言",
                  "pm.test('Response has correct structure', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('code');",
                  "    pm.expect(jsonData).to.have.property('message');",
                  "    pm.expect(jsonData).to.have.property('data');",
                  "});",
                  "",
                  "// 4. 业务数据断言",
                  "pm.test('Business data validation', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.code).to.eql(0);",
                  "    pm.expect(jsonData.data).to.have.property('items');",
                  "    pm.expect(jsonData.data.items).to.be.an('array');",
                  "    pm.expect(jsonData.data.pagination).to.have.property('page', 1);",
                  "});",
                  "",
                  "// 5. Schema验证（如适用）",
                  "pm.test('Schema validation', function () {",
                  "    const schema = {",
                  "        type: 'object',",
                  "        required: ['code', 'message', 'data'],",
                  "        properties: {",
                  "            code: { type: 'integer' },",
                  "            message: { type: 'string' },",
                  "            data: {",
                  "                type: 'object',",
                  "                properties: {",
                  "                    items: { type: 'array' },",
                  "                    pagination: { type: 'object' }",
                  "                }",
                  "            }",
                  "        }",
                  "    };",
                  "    pm.response.to.have.jsonSchema(schema);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{authToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/appointments?page=1&pageSize=20&status=待审核",
              "host": ["{{baseUrl}}"],
              "path": ["appointments"],
              "query": [
                {
                  "key": "page",
                  "value": "1",
                  "description": "页码"
                },
                {
                  "key": "pageSize",
                  "value": "20",
                  "description": "每页记录数"
                },
                {
                  "key": "status",
                  "value": "待审核",
                  "description": "预约状态"
                }
              ]
            }
          }
        },
        {
          "name": "❌ 参数验证失败 - page为0（边界值）",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('Error message contains validation info', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.code).to.eql(400001);",
                  "    pm.expect(jsonData.message).to.include('page');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{authToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/appointments?page=0&pageSize=20",
              "host": ["{{baseUrl}}"],
              "path": ["appointments"],
              "query": [
                {
                  "key": "page",
                  "value": "0",
                  "description": "非法页码（边界值测试）"
                },
                {
                  "key": "pageSize",
                  "value": "20"
                }
              ]
            }
          }
        },
        {
          "name": "❌ 参数类型错误 - page为字符串",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('Error indicates type validation failure', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.code).to.be.oneOf([400001, 400002]);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{authToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/appointments?page=abc&pageSize=20",
              "host": ["{{baseUrl}}"],
              "path": ["appointments"],
              "query": [
                {
                  "key": "page",
                  "value": "abc",
                  "description": "非法类型（应为整数）"
                },
                {
                  "key": "pageSize",
                  "value": "20"
                }
              ]
            }
          }
        },
        {
          "name": "❌ 未授权访问 - 缺少Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 401', function () {",
                  "    pm.response.to.have.status(401);",
                  "});",
                  "",
                  "pm.test('Error indicates authentication failure', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.code).to.eql(401001);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/appointments?page=1&pageSize=20",
              "host": ["{{baseUrl}}"],
              "path": ["appointments"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "pageSize",
                  "value": "20"
                }
              ]
            }
          }
        },
        {
          "name": "⚠️ 边界值测试 - pageSize为最大值100",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Returns at most 100 items', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.items.length).to.be.at.most(100);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{authToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/appointments?page=1&pageSize=100",
              "host": ["{{baseUrl}}"],
              "path": ["appointments"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "pageSize",
                  "value": "100",
                  "description": "最大分页大小（边界值）"
                }
              ]
            }
          }
        }
      ]
    }
  ]
}
```

### 2. 质量要求

#### 测试覆盖率（强制）

每个接口必须包含以下5类测试用例：

| 用例类型 | 说明 | 示例 | emoji标识 |
|---------|------|------|----------|
| **成功场景** | 正常参数，验证业务功能 | 查询第1页数据，返回成功 | ✅ |
| **参数缺失** | 缺少必填参数 | 缺少page参数 | ❌ |
| **参数格式错误** | 类型/格式不符合要求 | page为字符串"abc" | ❌ |
| **边界值** | 最小值、最大值、临界值 | page=0, pageSize=101 | ⚠️ |
| **业务规则校验** | 违反业务逻辑 | 取消已完成的预约 | ❌ |
| **认证授权** | 缺少Token、Token过期、无权限 | 未登录访问 | ❌ |

**覆盖率计算**:
- 每个GET接口: 至少5个用例（1成功 + 2参数 + 1边界 + 1认证）
- 每个POST/PUT接口: 至少8个用例（1成功 + 3参数 + 2业务规则 + 1边界 + 1认证）
- 每个DELETE接口: 至少6个用例（1成功 + 1业务规则 + 2边界 + 1认证）

#### 断言完整性（强制）

每个测试用例的`test`脚本必须包含：

1. **状态码断言**（必需）:
```javascript
pm.test('Status code is 200', function () {
    pm.response.to.have.status(200);
});
```

2. **响应时间断言**（成功场景必需）:
```javascript
pm.test('Response time is less than 3000ms', function () {
    pm.expect(pm.response.responseTime).to.be.below(3000);
});
```

3. **响应结构断言**（必需）:
```javascript
pm.test('Response has correct structure', function () {
    const jsonData = pm.response.json();
    pm.expect(jsonData).to.have.property('code');
    pm.expect(jsonData).to.have.property('message');
    pm.expect(jsonData).to.have.property('data');
});
```

4. **业务数据断言**（成功场景必需）:
```javascript
pm.test('Business data validation', function () {
    const jsonData = pm.response.json();
    pm.expect(jsonData.code).to.eql(0);
    pm.expect(jsonData.data.items).to.be.an('array');
});
```

5. **Schema验证**（可选，推荐用于复杂响应）:
```javascript
pm.test('Schema validation', function () {
    const schema = { /* JSON Schema */ };
    pm.response.to.have.jsonSchema(schema);
});
```

#### 测试数据设计（强制）

- **正常值**: 使用符合业务规则的真实数据（如手机号13800138000）
- **边界值**: 最小值、最大值、临界值（如page=1, page=0, pageSize=100, pageSize=101）
- **异常值**: 空字符串、null、超长字符串、特殊字符（如SQL注入`'; DROP TABLE--`）
- **类型错误**: 字符串/整数/布尔混用（如page="abc", status=123）

**❌ 错误示例**（测试数据不合理）:
```json
{
  "visitorName": "测试",  // 太简单
  "phone": "123"         // 不符合格式
}
```

**✅ 正确示例**（测试数据合理）:
```json
{
  "visitorName": "张三",
  "phone": "13800138000",
  "idCard": "110101199001011234",
  "visitDate": "2024-12-31T14:00:00Z"
}
```

#### 环境变量管理（强制）

在Collection的`variable`中定义：

```json
"variable": [
  {
    "key": "baseUrl",
    "value": "https://dev.example.com/api/v1",
    "type": "string"
  },
  {
    "key": "authToken",
    "value": "{{your_token_here}}",
    "type": "string",
    "description": "在Postman Environment中配置"
  }
]
```

**使用方式**:
- 请求URL: `{{baseUrl}}/appointments`
- 请求头: `Authorization: Bearer {{authToken}}`

### 3. 格式规范

- **文件格式**: Postman Collection v2.1（JSON格式）
- **命名规范**:
  - Collection名称: `{模块名称} API测试用例集`
  - 文件夹名称: `{接口名称}`（如"查询预约记录"）
  - 测试用例名称: `{emoji} {场景} - {说明}`（如"✅ 成功场景 - 查询第1页数据"）
- **emoji使用**:
  - ✅ 成功场景
  - ❌ 失败场景（参数错误、业务规则、认证）
  - ⚠️ 边界值/特殊场景
  - 🔧 性能测试
- **代码格式**: 测试脚本使用标准JavaScript，每个断言独立一个`pm.test()`

### 4. 特别说明

#### POST/PUT请求的Body测试（重要！）

对于创建/更新接口，必须测试Body参数的各种情况：

**成功场景**:
```json
{
  "name": "✅ 成功场景 - 创建预约",
  "request": {
    "method": "POST",
    "body": {
      "mode": "raw",
      "raw": "{\n  \"visitorName\": \"张三\",\n  \"phone\": \"13800138000\",\n  \"visitDate\": \"2024-12-31T14:00:00Z\"\n}",
      "options": {
        "raw": {
          "language": "json"
        }
      }
    }
  }
}
```

**参数缺失场景**（每个必填字段1个用例）:
```json
{
  "name": "❌ 参数缺失 - 缺少visitorName",
  "request": {
    "body": {
      "raw": "{\n  \"phone\": \"13800138000\",\n  \"visitDate\": \"2024-12-31T14:00:00Z\"\n}"
    }
  },
  "event": [{
    "listen": "test",
    "script": {
      "exec": [
        "pm.test('Status code is 400', () => pm.response.to.have.status(400));",
        "pm.test('Error mentions missing field', () => {",
        "    pm.expect(pm.response.json().message).to.include('visitorName');",
        "});"
      ]
    }
  }]
}
```

**格式错误场景**:
```json
{
  "name": "❌ 格式错误 - 手机号格式不正确",
  "request": {
    "body": {
      "raw": "{\n  \"visitorName\": \"张三\",\n  \"phone\": \"123\",\n  \"visitDate\": \"2024-12-31T14:00:00Z\"\n}"
    }
  }
}
```

#### 认证Token获取（前置脚本）

如果需要动态获取Token，在Collection的`event`中添加：

```json
{
  "listen": "prerequest",
  "script": {
    "exec": [
      "// 方式1：从登录接口获取Token（仅执行一次）",
      "if (!pm.collectionVariables.get('authToken')) {",
      "    pm.sendRequest({",
      "        url: pm.variables.get('baseUrl') + '/auth/login',",
      "        method: 'POST',",
      "        header: { 'Content-Type': 'application/json' },",
      "        body: {",
      "            mode: 'raw',",
      "            raw: JSON.stringify({",
      "                username: 'testuser',",
      "                password: 'testpass'",
      "            })",
      "        }",
      "    }, function (err, res) {",
      "        if (!err) {",
      "            const token = res.json().data.token;",
      "            pm.collectionVariables.set('authToken', token);",
      "        }",
      "    });",
      "}",
      "",
      "// 方式2：使用固定Token（简单但需定期更新）",
      "// pm.collectionVariables.set('authToken', 'your_fixed_token_here');"
    ],
    "type": "text/javascript"
  }
}
```

#### 参数化测试（数据驱动）

对于需要多组数据测试的场景，使用Postman的Data File功能：

**步骤**:
1. 创建CSV文件（如`test-data.csv`）:
```csv
visitorName,phone,expectedStatus
张三,13800138000,200
李四,13900139000,200
,13800138000,400
张三,123,400
```

2. 在测试用例中使用变量:
```json
{
  "request": {
    "body": {
      "raw": "{\n  \"visitorName\": \"{{visitorName}}\",\n  \"phone\": \"{{phone}}\"\n}"
    }
  },
  "event": [{
    "listen": "test",
    "script": {
      "exec": [
        "pm.test('Status code matches expected', () => {",
        "    const expected = parseInt(pm.iterationData.get('expectedStatus'));",
        "    pm.response.to.have.status(expected);",
        "});"
      ]
    }
  }]
}
```

3. 在Postman Runner中导入CSV文件执行

#### 性能测试用例（可选）

如果需要性能测试，添加专门的性能测试文件夹：

```json
{
  "name": "🔧 性能测试",
  "item": [
    {
      "name": "并发100用户查询接口",
      "request": { /* 同功能测试 */ },
      "event": [{
        "listen": "test",
        "script": {
          "exec": [
            "pm.test('Response time < 3s under load', () => {",
            "    pm.expect(pm.response.responseTime).to.be.below(3000);",
            "});",
            "",
            "pm.test('No errors under load', () => {",
            "    pm.response.to.have.status(200);",
            "});"
          ]
        }
      }]
    }
  ]
}
```

**运行方式**: 在Postman Runner中设置Iterations=100，Delay=0ms

### 5. 输出格式

输出完整的Postman Collection JSON，格式如下：

```markdown
## 接口测试用例集（Postman Collection）

### 文件名
`{模块名称}-API测试用例集.postman_collection.json`

### 完整JSON内容

\`\`\`json
{完整的Postman Collection JSON}
\`\`\`

### 导入方式

**方式1：直接导入Postman**
1. 打开Postman
2. 点击左上角 "Import"
3. 选择 "Raw text"
4. 粘贴上述JSON内容
5. 点击 "Import"

**方式2：保存为文件后导入**
1. 将JSON保存为`.postman_collection.json`文件
2. Postman → Import → Upload Files
3. 选择保存的文件

### 配置环境变量

在Postman中创建Environment，添加变量：
- `baseUrl`: API服务器地址（如https://dev.example.com/api/v1）
- `authToken`: 认证Token（可通过登录接口获取或手动填写）

### 运行测试

**单个用例运行**:
1. 选择测试用例
2. 点击 "Send"
3. 查看 "Test Results"

**批量运行（Collection Runner）**:
1. 点击Collection右侧的 "..."
2. 选择 "Run collection"
3. 配置Iterations（迭代次数）、Delay（延迟）
4. 点击 "Run {模块名称} API测试用例集"
5. 查看测试报告

**命令行运行（Newman）**:
```bash
npm install -g newman
newman run {模块名称}-API测试用例集.postman_collection.json \
  --environment {环境配置}.postman_environment.json \
  --reporters cli,html \
  --reporter-html-export test-report.html
```

### 测试覆盖率

本用例集共{N}个测试用例，覆盖：
- ✅ 成功场景: {X}个
- ❌ 参数验证: {Y}个
- ⚠️ 边界值: {Z}个
- ❌ 业务规则: {M}个
- ❌ 认证授权: {N}个

覆盖率: {百分比}%

### 下一步操作

- 将Collection导入CI/CD流程（使用Newman）
- 定期执行回归测试，确保接口稳定性
```

不要有任何前言或解释，直接输出文档。

---

## ✨ 使用说明

### 如何使用此提示词

1. **准备输入材料**
   - OpenAPI文档（从步骤8的输出获取，推荐）或
   - API接口设计文档（从步骤7的输出获取）

2. **复制提示词**
   - 从"你是一位资深API测试工程师"开始

3. **粘贴到AI工具**
   - 将提示词和OpenAPI文档一起提交

4. **生成测试用例集**
   - AI将生成Postman Collection JSON格式的测试用例

5. **导入Postman验证**（重要！）
   - 复制JSON → Postman → Import → Raw text
   - 检查是否有导入错误
   - 配置环境变量（baseUrl, authToken）

6. **运行测试验证**
   - **单个用例**: 点击用例 → Send → 查看Test Results
   - **批量运行**: Collection右键 → Run collection
   - **检查断言**: 确保所有断言逻辑正确

7. **优化测试用例**（根据实际情况调整）
   - **补充测试数据**: 根据真实业务补充边界值、异常值
   - **调整断言**: 根据实际响应调整断言逻辑
   - **添加业务场景**: 补充特定业务规则的测试用例

8. **保存文档**
   - 保存到`outputs/09-{模块名称}-API测试用例集.postman_collection.json`

### 预期生成时间

- AI生成：8-12分钟
- 导入验证：5-10分钟
- 运行测试：10-15分钟
- 优化调整：30-60分钟

### 集成到CI/CD

生成的测试用例可集成到Jenkins/GitLab CI：

```yaml
# .gitlab-ci.yml示例
api-test:
  stage: test
  script:
    - npm install -g newman
    - newman run 访客预约-API测试用例集.postman_collection.json \
        --environment dev.postman_environment.json \
        --reporters cli,junit \
        --reporter-junit-export test-results.xml
  artifacts:
    reports:
      junit: test-results.xml
```

### 下一步操作

测试用例生成后：
1. 执行回归测试，确保接口质量
2. 集成到CI/CD流水线，实现自动化测试
3. 定期更新测试用例，保持与接口同步

---

**📌 重要提醒**：
- 测试用例是保证接口质量的关键，必须定期执行
- 断言逻辑必须准确，避免误报（False Positive）
- 测试数据应使用Mock数据或测试专用数据，不要污染生产环境
- 认证Token需要定期更新，避免过期导致测试失败
- 集成到CI/CD后，每次代码提交都应自动运行测试
