# US001: 微信公众号在线预约功能

## 📖 用户故事

> **作为** 访客  
> **我希望** 通过微信公众号在线提交来访预约申请  
> **以便于** 无需电话联系，提前完成来访登记，节省现场办理时间

---

## ✅ 验收规则清单

### 一、功能规则（核心功能验证）

**规则类别说明**: 验证核心业务功能是否正确实现

| # | 验收规则 | 验证方式 | 优先级 |
|---|---------|---------|--------|
| F1 | 访客可以通过微信公众号入口访问预约功能 | 关注公众号 → 点击菜单"来访预约" → 打开预约页面 | P0 |
| F2 | 访客可以填写完整的预约信息并提交 | 填写姓名、手机号、来访时间、被访人、来访事由 → 点击"提交预约" → 显示提交成功 | P0 |
| F3 | 提交预约后系统生成唯一的预约编号 | 提交成功后显示预约编号（如：YY20251226001） | P0 |
| F4 | 访客可以查看已提交的预约记录 | 点击"我的预约" → 显示历史预约列表，包含状态、时间、被访人 | P1 |
| F5 | 访客可以取消未审核的预约 | 在预约详情页点击"取消预约" → 确认后状态变为"已取消" | P1 |

---

### 二、数据规则（数据完整性与有效性）

**规则类别说明**: 验证数据的正确性、完整性、一致性

| # | 验收规则 | 验证方式 | 优先级 |
|---|---------|---------|--------|
| D1 | 姓名必须填写，2-20个字符 | 不填姓名点击提交 → 提示"请输入姓名"；输入1个字/21个字 → 提示"姓名长度为2-20个字符" | P0 |
| D2 | 手机号必须为11位有效号码 | 输入10位/12位/非数字 → 提示"请输入正确的手机号" | P0 |
| D3 | 来访时间必须为未来时间 | 选择过去的日期 → 提示"来访时间不能早于当前时间" | P0 |
| D4 | 来访时间需在可预约时间范围内 | 选择非工作日或非工作时间（如晚上10点） → 提示"请选择工作日09:00-17:00的时间段" | P1 |
| D5 | 被访人姓名必须在企业人员名录中 | 输入不存在的被访人 → 提示"未找到该员工，请核实姓名" | P1 |
| D6 | 来访事由必须填写，不少于5个字 | 不填或填少于5个字 → 提示"请输入来访事由（至少5个字）" | P0 |

---

### 三、交互规则（用户界面与交互体验）

**规则类别说明**: 验证界面展示、交互流程、用户反馈

| # | 验收规则 | 验证方式 | 优先级 |
|---|---------|---------|--------|
| I1 | 预约表单显示所有必填字段及标识 | 打开预约页面 → 检查姓名、手机号、来访时间、被访人、来访事由字段，必填项标注红色*号 | P0 |
| I2 | 来访时间支持日期和时间选择器 | 点击"来访时间"字段 → 弹出日期选择器（显示日历） → 选择日期后弹出时间选择器（小时:分钟） | P0 |
| I3 | 被访人字段支持搜索联想功能 | 输入被访人姓名前2个字（如"张三"的"张"） → 下拉显示姓"张"的员工列表（最多显示10条） | P1 |
| I4 | 提交成功后显示预约详情页 | 提交成功 → 自动跳转到预约详情页，显示预约编号、预约信息、二维码（用于现场核验） | P0 |
| I5 | 预约详情页支持截图保存 | 预约详情页显示"保存到相册"按钮 → 点击后保存预约凭证图片到手机 | P1 |
| I6 | 表单字段输入提供实时格式提示 | 输入手机号时，输入框下方显示格式提示"请输入11位手机号" | P2 |

---

### 四、异常规则（异常处理与容错性）

**规则类别说明**: 验证错误提示、异常处理、边界情况

| # | 验收规则 | 验证方式 | 优先级 |
|---|---------|---------|--------|
| E1 | 必填字段未填写时阻止提交并提示 | 留空姓名字段点击提交 → 姓名输入框变红，显示"请输入姓名"，不发送请求 | P0 |
| E2 | 网络异常时显示友好错误提示 | 关闭手机网络 → 点击提交 → 显示"网络连接失败，请检查网络后重试"，提供"重试"按钮 | P1 |
| E3 | 提交失败时保留已填写内容 | 网络中断导致提交失败 → 点击重试 → 表单内容仍保留，无需重新填写 | P1 |
| E4 | 同一时段同一被访人预约次数限制 | 短时间内提交多次预约（如5分钟内3次） → 提示"您已有待审核的预约，请勿重复提交" | P1 |
| E5 | 超过可预约范围的时间自动调整 | 选择3个月后的日期 → 提示"预约时间超出范围，最多可预约未来30天" | P2 |
| E6 | 被访人休假或出差时的提示 | 选择被访人后，系统检测到该人员当天请假 → 提示"该员工当天休假，建议改约其他时间" | P2 |

---

### 五、性能规则（性能与安全要求）

**规则类别说明**: 验证响应时间、并发能力、安全性（如适用）

| # | 验收规则 | 验证方式 | 优先级 |
|---|---------|---------|--------|
| P1 | 表单页面加载时间<3秒（4G网络） | 使用4G网络打开预约页面 → 浏览器开发工具测量DOMContentLoaded时间 | P1 |
| P2 | 提交预约接口响应时间<2秒 | 填写完整信息点击提交 → 浏览器Network面板查看接口耗时 | P1 |
| P3 | 个人信息脱敏展示 | 查看预约列表 → 手机号显示为"138****5678"格式 | P0 |
| P4 | 预约数据加密传输 | 浏览器开发工具Network面板 → 检查请求协议为HTTPS，Content-Type包含加密标识 | P0 |
| P5 | 支持100+访客同时提交预约 | 模拟100个并发请求 → 系统正常响应，无报错或超时 | P2 |

---

## 📋 验收检查表（快速确认）

**使用说明**: 演示或验收时，按此清单逐项确认，全部标记✅即通过验收。

### 核心功能检查

- [ ] **F1** - 微信公众号可以打开预约页面
- [ ] **F2** - 可以填写信息并成功提交预约
- [ ] **F3** - 提交后生成唯一预约编号
- [ ] **D1** - 姓名字段校验有效（2-20字符）
- [ ] **D2** - 手机号格式校验有效（11位数字）
- [ ] **D3** - 来访时间不能选择过去时间
- [ ] **I1** - 预约表单显示所有必填字段
- [ ] **I4** - 提交成功后显示预约详情和二维码
- [ ] **E1** - 必填字段未填写时有错误提示
- [ ] **P3** - 手机号脱敏显示（138****5678）
- [ ] **P4** - 数据通过HTTPS加密传输

### 可选功能检查

- [ ] **F4** - 可以查看历史预约记录
- [ ] **F5** - 可以取消未审核的预约
- [ ] **D5** - 被访人姓名在企业名录中验证
- [ ] **I3** - 被访人字段支持搜索联想
- [ ] **I5** - 预约详情可保存为图片
- [ ] **E3** - 提交失败时保留已填写内容
- [ ] **P1** - 页面加载时间<3秒
- [ ] **P2** - 提交接口响应<2秒

---

## 🎯 验收场景脚本

**场景1: 正常预约流程（Happy Path）**

1. 打开微信 → 搜索并关注"{企业名称}访客系统"公众号
2. 点击底部菜单"来访预约"
3. 填写预约信息：
   - 姓名：张三
   - 手机号：13812345678
   - 来访时间：选择明天 14:00
   - 被访人：输入"李四" → 从下拉列表选择"李四（研发部）"
   - 来访事由：洽谈合作项目
4. 点击"提交预约"
5. 检查预约详情页

**预期**: ✅ F1, F2, F3, D1, D2, D3, D6, I1, I2, I4 通过  
**成功标志**: 显示预约编号（如YY20251227001）、预约详情、现场核验二维码

---

**场景2: 数据校验（异常处理）**

1. 打开预约页面
2. 测试姓名校验：
   - 不填姓名点击提交 → 检查提示"请输入姓名"
   - 输入单字"张" → 检查提示"姓名长度为2-20个字符"
3. 测试手机号校验：
   - 输入10位手机号"1381234567" → 检查提示"请输入正确的手机号"
   - 输入12位手机号"138123456789" → 检查提示"请输入正确的手机号"
4. 测试时间校验：
   - 选择昨天的日期 → 检查提示"来访时间不能早于当前时间"
5. 测试来访事由：
   - 输入3个字"测试" → 检查提示"请输入来访事由（至少5个字）"

**预期**: ✅ D1, D2, D3, D6, E1 通过  
**成功标志**: 所有格式错误都有清晰的提示信息，不允许提交

---

**场景3: 预约查询与取消**

1. 使用场景1创建一条预约记录
2. 返回公众号首页，点击"我的预约"
3. 检查预约列表显示：
   - 预约编号
   - 来访时间
   - 被访人
   - 状态（待审核）
4. 点击预约记录进入详情页
5. 点击"取消预约" → 确认弹窗点击"确定"
6. 检查状态变为"已取消"

**预期**: ✅ F4, F5, I1 通过  
**成功标志**: 可以查看历史预约，可以取消待审核状态的预约

---

**场景4: 边界条件与性能验证**

1. **测试时间边界**：
   - 尝试选择今天之前的日期 → 检查被禁用或提示错误
   - 尝试选择31天后的日期 → 检查提示"最多可预约未来30天"
2. **测试性能**：
   - 打开浏览器开发者工具（F12） → Network面板
   - 打开预约页面 → 记录页面加载时间（应<3秒）
   - 提交预约 → 记录接口响应时间（应<2秒）
3. **测试数据安全**：
   - 查看我的预约列表 → 检查手机号显示格式为"138****5678"
   - Network面板检查请求 → 确认使用HTTPS协议

**预期**: ✅ E5, P1, P2, P3, P4 通过  
**成功标志**: 边界条件有正确限制，性能达标，数据安全

---

## 📝 验收说明

### 验收前提条件

**环境要求**：
- 测试环境已部署最新代码（v1.0.0-预约功能）
- 微信公众号测试号已配置并关联测试环境
- 测试服务器可通过外网访问（微信回调需要）

**数据准备**：
- 准备至少5个未使用的测试手机号（用于注册不同访客）
- 企业人员名录中至少有10个员工数据（用于测试被访人搜索）
- 预留明天、后天、大后天的可预约时间段

**工具准备**：
- 微信开发者工具或真实手机微信（建议真机测试）
- 浏览器开发者工具（Chrome DevTools，用于性能测试）
- 抓包工具（如Charles，用于验证HTTPS加密，可选）

---

### 验收执行顺序

#### **第一轮：核心功能验证（预计30分钟）**

验证范围：F1-F3, D1-D3, D6, I1, I4, E1  
执行方式：手动操作，完整走通预约流程  
通过标准：P0规则100%通过

#### **第二轮：交互与异常验证（预计20分钟）**

验证范围：F4-F5, D4-D5, I2-I3, I5-I6, E2-E4  
执行方式：针对性测试各异常场景  
通过标准：P1规则≥90%通过

#### **第三轮：性能与安全验证（预计15分钟）**

验证范围：P1-P5, E5-E6  
执行方式：使用开发者工具测量性能指标，检查安全配置  
通过标准：P1规则≥90%通过，P2规则≥80%通过

---

### 验收通过标准

#### **必达标准**（不满足则不通过验收）

- ✅ P0规则100%通过（共12条）
- ✅ 核心功能F1-F3全部可用
- ✅ 数据校验D1-D3全部有效
- ✅ 数据安全P3-P4全部满足
- ✅ 无P0级别阻塞性Bug

#### **优秀标准**（建议达到）

- ✅ P0规则100%通过 + P1规则≥95%通过
- ✅ 性能指标全部达标（P1, P2）
- ✅ 交互体验优秀（I3, I5, I6实现）
- ✅ 异常提示清晰友好

#### **可延后优化**（不阻塞上线）

- P2规则部分未实现（如I6、E5-E6、P5）
- 次要功能体验优化（如被访人头像显示）
- 非核心边界情况处理

---

### 阻塞性问题定义

#### **P0阻塞**（必须立即修复，否则不能上线）

**功能类**：
- 无法打开预约页面（F1失败）
- 无法提交预约（F2失败）
- 提交后未生成预约编号（F3失败）

**数据类**：
- 数据校验失效，允许提交无效数据（D1-D3失败）
- 来访时间可选择过去时间（D3失败）

**安全类**：
- 手机号明文显示（P3失败）
- 使用HTTP传输敏感数据（P4失败）
- 存在SQL注入或XSS漏洞

---

#### **P1阻塞**（优先修复，影响用户体验）

**交互类**：
- 提交成功后无任何反馈（I4失败）
- 必填字段未标注，用户不知道哪些必填（I1失败）

**异常类**：
- 网络异常时页面卡死，无错误提示（E2失败）
- 提交失败后表单内容丢失（E3失败）

**性能类**：
- 页面加载时间超过6秒（P1超出2倍预期）
- 提交接口响应时间超过4秒（P2超出2倍预期）

---

#### **P2不阻塞**（可延后修复或优化）

**体验优化**：
- 被访人搜索联想不够智能（I3优化）
- 表单字段缺少实时格式提示（I6缺失）

**边界情况**：
- 超出30天预约无提示（E5缺失）
- 被访人休假未提示（E6缺失）

**性能优化**：
- 并发100+时响应稍慢（P5未达标）

---

### 验收报告模板

```markdown
## 微信公众号在线预约功能验收报告

**验收时间**: 2025-12-27  
**验收人**: {姓名}  
**功能版本**: v1.0.0  

### 一、验收结果

- ✅ P0规则通过率: 12/12 (100%)
- ✅ P1规则通过率: 15/16 (93.75%)
- ⚠️ P2规则通过率: 4/6 (66.67%)

**结论**: 🎉 **通过验收，可以上线**

### 二、发现问题

#### P1问题（需优先修复）

| 问题编号 | 规则 | 问题描述 | 复现步骤 | 严重程度 |
|---------|------|---------|---------|---------|
| BUG-001 | I3 | 被访人搜索联想延迟较高（约2秒） | 输入姓名首字母 → 等待2秒才显示列表 | P1 |

#### P2问题（可延后优化）

| 问题编号 | 规则 | 问题描述 | 建议 |
|---------|------|---------|------|
| OPT-001 | I6 | 表单字段缺少实时格式提示 | 建议在输入框下方增加灰色提示文字 |
| OPT-002 | E6 | 被访人休假时无提示 | 后续版本集成OA系统，实时同步休假状态 |

### 三、优秀表现

- ✅ 数据校验全面，错误提示清晰友好
- ✅ 预约详情页二维码设计优秀，便于现场核验
- ✅ 数据安全措施到位（HTTPS + 手机号脱敏）
- ✅ 页面加载速度快（平均1.8秒）

### 四、上线建议

**建议上线时间**: 2025-12-28（周六凌晨2:00，访问量低谷）  
**灰度策略**: 先开放给内部员工使用1天，无问题后全量发布  
**监控重点**: 提交成功率、接口响应时间、错误日志
```

---

**💡 验收通过后的后续工作**：

1. ✅ 将BUG-001（被访人搜索延迟）加入Sprint Backlog，优先级P1
2. ✅ 将OPT-001、OPT-002加入产品Backlog，后续迭代优化
3. ✅ 整理验收场景脚本，作为回归测试用例库
4. ✅ 更新用户手册，添加微信预约功能使用说明
5. ✅ 准备上线通知，告知访客新功能上线
